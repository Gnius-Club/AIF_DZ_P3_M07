<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>El Jard√≠n de la Amistad: Edici√≥n Master</title>
    <style>
        /* --- ESTILOS GENERALES --- */
        * { box-sizing: border-box; user-select: none; -webkit-tap-highlight-color: transparent; }
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; overflow: hidden; font-family: 'Segoe UI', sans-serif; }

        /* --- FONDO --- */
        #game-world {
            position: relative; width: 100%; height: 100%; display: flex; flex-direction: column; overflow: hidden;
            transition: background 1s;
        }
        
        /* Filtros */
        .gray-filter { filter: grayscale(100%) contrast(0.9); transition: filter 1s ease; }

        /* Capas de Fondo Din√°micas */
        .sky { flex: 2; background: linear-gradient(to bottom, #87CEEB, #E0F7FA); position: relative; z-index: 1; transition: background 1s;}
        .ground { flex: 1; background: linear-gradient(to bottom, #7CFC00, #228B22); position: relative; z-index: 2; margin-bottom: 90px; transition: background 1s;}

        /* Variaciones de Nivel (Clases aplicadas por JS) */
        .level-2 .sky { background: linear-gradient(to bottom, #5f788a, #aab7b8); } /* Nublado */
        .level-2 .ground { background: linear-gradient(to bottom, #556B2F, #2F4F4F); }
        .level-3 .sky { background: linear-gradient(to bottom, #FFDAB9, #FFEFD5); } /* Atardecer */
        .level-3 .ground { background: linear-gradient(to bottom, #deb887, #8B4513); } /* Tierra/Parquet */

        /* Nubes / Elementos flotantes */
        .cloud {
            position: absolute; background: #fff; border-radius: 50px; opacity: 0.8;
            animation: floatCloud 25s infinite linear;
        }
        .cloud::after, .cloud::before { content: ''; position: absolute; background: #fff; border-radius: 50%; }
        .c1 { width: 100px; height: 40px; top: 10%; left: -10%; }
        .c1::after { width: 50px; height: 50px; top: -25px; left: 15px; }
        .c1::before { width: 40px; height: 40px; top: -15px; left: 50px; }
        @keyframes floatCloud { 0% { transform: translateX(-150px); } 100% { transform: translateX(120vw); } }

        /* --- PERSONAJES --- */
        .characters-container {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none; display: flex; justify-content: space-around; align-items: flex-end;
            padding-bottom: 130px; z-index: 10;
        }
        .char-zone {
            position: relative; width: 30%; height: 320px;
            display: flex; flex-direction: column; align-items: center; justify-content: flex-end;
            pointer-events: auto; transition: transform 0.3s ease;
        }
        .avatar { font-size: 4.5rem; transition: transform 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275); z-index: 12; cursor: pointer; }
        
        .bubble {
            background: white; padding: 10px 12px; border-radius: 15px; position: absolute; top: 10px;
            font-size: 0.85rem; text-align: center; box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            max-width: 140px; min-width: 100px; transition: opacity 0.5s; font-weight: bold; color: #333;
        }
        .bubble::after {
            content: ''; position: absolute; bottom: -10px; left: 50%; transform: translateX(-50%);
            border-width: 10px 10px 0; border-style: solid; border-color: white transparent transparent transparent;
        }

        /* Efectos Decorativos */
        .decor {
            position: absolute; font-size: 2.5rem; opacity: 0; transform: scale(0);
            transition: all 0.6s cubic-bezier(0.68, -0.55, 0.27, 1.55); z-index: 11;
        }
        .decor.bloomed { opacity: 1; transform: scale(1); }
        .happy-anim { animation: happyJump 0.6s ease infinite; }
        @keyframes happyJump { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-20px); } }

        /* --- UI SEMILLAS --- */
        .seed-bar {
            position: absolute; bottom: 0; left: 0; width: 100%; height: 110px;
            background: rgba(255, 255, 255, 0.95); border-top: 5px solid #8B4513;
            display: flex; justify-content: space-around; align-items: center; z-index: 100;
            box-shadow: 0 -5px 15px rgba(0,0,0,0.2); padding-bottom: 10px;
        }
        .seed-container { display: flex; flex-direction: column; align-items: center; width: 22%; }
        
        .seed {
            width: 55px; height: 55px; border-radius: 50%; display: flex; justify-content: center; align-items: center;
            font-size: 1.8rem; cursor: grab; transition: transform 0.2s; position: relative;
            background: #ddd; border: 3px solid #999; box-shadow: 0 4px 5px rgba(0,0,0,0.2);
        }
        .seed:active { cursor: grabbing; transform: scale(1.1); }
        
        .seed-label { font-size: 0.75rem; margin-top: 6px; font-weight: bold; color: #444; text-align: center; line-height: 1.1; }

        /* Colores de Semillas */
        .seed[data-color="orange"] { background: #FFAF40; border-color: #d35400; }
        .seed[data-color="yellow"] { background: #FFF200; border-color: #f39c12; }
        .seed[data-color="green"]  { background: #7CFC00; border-color: #27ae60; }
        .seed[data-color="blue"]   { background: #3498db; border-color: #2980b9; }
        .seed[data-color="pink"]   { background: #FFB7B2; border-color: #E74C3C; } /* Amor/Consuelo */
        .seed[data-color="purple"] { background: #D2B4DE; border-color: #8E44AD; } /* Ayuda */
        .seed[data-color="teal"]   { background: #A2D9CE; border-color: #16A085; } /* Calma */
        .seed[data-color="red"]    { background: #ff6b6b; border-color: #c0392b; } /* Distractor */

        /* Clon arrastrable */
        .dragging-clone {
            position: fixed; pointer-events: none; z-index: 1000; width: 70px; height: 70px;
            border-radius: 50%; display: flex; justify-content: center; align-items: center;
            font-size: 2.2rem; opacity: 0.9; box-shadow: 0 10px 20px rgba(0,0,0,0.4);
        }

        /* --- MENSAJES --- */
        #level-indicator {
            position: absolute; top: 10px; left: 10px; background: rgba(255,255,255,0.8);
            padding: 5px 15px; border-radius: 20px; font-weight: bold; color: #333; z-index: 50;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }

        #message-toast {
            position: absolute; top: 20%; left: 50%; transform: translateX(-50%);
            background: rgba(0,0,0,0.8); color: white; padding: 12px 25px; border-radius: 25px;
            font-size: 1.1rem; opacity: 0; pointer-events: none; transition: opacity 0.3s;
            z-index: 200; text-align: center; width: 80%;
        }

        #modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.7); display: none; justify-content: center; align-items: center;
            flex-direction: column; z-index: 300; backdrop-filter: blur(5px); animation: fadeIn 0.5s;
        }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        .modal-content {
            background: white; padding: 30px; border-radius: 20px; text-align: center;
            max-width: 90%; width: 400px; box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }
        .modal-content h2 { margin: 0 0 15px; color: #2ecc71; font-size: 2rem; }
        .modal-content p { font-size: 1.2rem; color: #555; margin-bottom: 25px; }
        
        button.btn-action {
            background: #3498db; color: white; border: none; padding: 12px 25px;
            font-size: 1.2rem; border-radius: 10px; cursor: pointer;
            box-shadow: 0 4px 0 #2980b9; transition: transform 0.1s; width: 100%;
        }
        button.btn-action:active { transform: translateY(4px); box-shadow: none; }

        @media (max-width: 600px) {
            .char-zone { width: 32%; }
            .avatar { font-size: 3.5rem; }
            .bubble { font-size: 0.7rem; top: 60px; min-width: auto; }
            .seed { width: 45px; height: 45px; font-size: 1.4rem; }
            .seed-bar { height: 95px; }
        }
    </style>
</head>
<body>

    <!-- MUNDO -->
    <div id="game-world">
        <div id="level-indicator">Nivel 1</div>
        <div class="sky gray-filter" id="bg-sky">
            <div class="cloud c1"></div>
        </div>
        <div class="ground gray-filter" id="bg-ground"></div>
        
        <!-- Contenedor din√°mico de personajes -->
        <div class="characters-container" id="chars-wrapper"></div>
    </div>

    <!-- UI DE SEMILLAS -->
    <div class="seed-bar" id="seed-bar-wrapper"></div>

    <!-- MENSAJES -->
    <div id="message-toast"></div>

    <!-- MODAL DE VICTORIA/NIVEL -->
    <div id="modal-overlay">
        <div class="modal-content">
            <h2 id="modal-title">¬°Excelente!</h2>
            <p id="modal-msg">Nivel completado.</p>
            <button class="btn-action" id="modal-btn" onclick="nextLevel()">Siguiente Nivel ‚û°Ô∏è</button>
        </div>
    </div>

    <script>
        /* --- CONFIGURACI√ìN DE NIVELES (DATA) --- */
        const LEVELS_DATA = [
            {
                id: 1,
                name: "El Jard√≠n Inicial",
                cssClass: "level-1",
                characters: [
                    {
                        id: 'leo', needs: 'encourage', 
                        startEmoji: 'üòü', endEmoji: 'üòÑ', 
                        bubbleStart: 'Examen ma√±ana... üìö', bubbleEnd: '¬°S√≠ puedo!', 
                        decor: 'üåª', msgCorrect: '¬°T√∫ puedes, Leo!', msgError: 'Leo necesita confianza.'
                    },
                    {
                        id: 'ana', needs: 'congrats', 
                        startEmoji: 'üé®', endEmoji: 'üòç', 
                        bubbleStart: '¬°Mi dibujo nuevo!', bubbleEnd: '¬°Gracias!', 
                        decor: 'ü¶ã', msgCorrect: '¬°Qu√© talento, Ana!', msgError: 'Ana quiere celebrar.'
                    },
                    {
                        id: 'marco', needs: 'interest', 
                        startEmoji: 'üòê', endEmoji: 'üôÇ', 
                        bubbleStart: '...', bubbleEnd: 'Estoy bien', 
                        decor: 'üå±', msgCorrect: '¬°Inter√©s genuino!', msgError: 'Marco se siente solo.'
                    }
                ],
                // Pool de semillas para este nivel (Correctas + 1 Distractor aleatorio)
                seeds: [
                    { type: 'encourage', label: '√Ånimo', icon: 'üí™', color: 'orange' },
                    { type: 'congrats', label: 'Felicitar', icon: 'üéâ', color: 'yellow' },
                    { type: 'interest', label: 'Inter√©s', icon: 'ü§î', color: 'green' }
                ]
            },
            {
                id: 2,
                name: "Parque Lluvioso",
                cssClass: "level-2", // CSS cambiar√° fondo a gris/lluvioso
                characters: [
                    {
                        id: 'sofia', needs: 'comfort', 
                        startEmoji: 'üò¢', endEmoji: 'ü§ó', 
                        bubbleStart: 'Se rompi√≥ mi juguete...', bubbleEnd: 'Ya pas√≥...', 
                        decor: '‚ù§Ô∏è', msgCorrect: '¬°Un abrazo ayuda!', msgError: 'Sofia est√° triste, necesita cari√±o.'
                    },
                    {
                        id: 'beto', needs: 'calm', 
                        startEmoji: 'üò†', endEmoji: 'üòå', 
                        bubbleStart: '¬°No es justo!', bubbleEnd: 'Respira...', 
                        decor: '‚ú®', msgCorrect: '¬°Calma recuperada!', msgError: 'Beto est√° enfadado, ay√∫dalo a calmarse.'
                    },
                    {
                        id: 'lucia', needs: 'help', 
                        startEmoji: 'üòµ‚Äçüí´', endEmoji: 'ü§ì', 
                        bubbleStart: 'No entiendo esto...', bubbleEnd: '¬°Ah, ya veo!', 
                        decor: 'üí°', msgCorrect: '¬°Gracias por la ayuda!', msgError: 'Lucia est√° confundida.'
                    }
                ],
                seeds: [
                    { type: 'comfort', label: 'Consuelo', icon: 'üß∏', color: 'pink' },
                    { type: 'calm', label: 'Calma', icon: 'üçÉ', color: 'teal' },
                    { type: 'help', label: 'Ayudar', icon: 'ü§ù', color: 'purple' }
                ]
            },
            {
                id: 3,
                name: "Escuela de Empat√≠a",
                cssClass: "level-3",
                characters: [
                    {
                        id: 'dani', needs: 'care', 
                        startEmoji: 'ü§í', endEmoji: 'üòä', 
                        bubbleStart: 'Me siento mal...', bubbleEnd: 'Mejorando', 
                        decor: 'üçµ', msgCorrect: '¬°Cuidaste a Dani!', msgError: 'Dani est√° enfermo.'
                    },
                    {
                        id: 'eva', needs: 'protect', 
                        startEmoji: 'üò®', endEmoji: 'üòå', 
                        bubbleStart: '¬°Qu√© oscuridad!', bubbleEnd: 'Estoy a salvo', 
                        decor: 'üõ°Ô∏è', msgCorrect: '¬°Seguridad brindada!', msgError: 'Eva tiene miedo.'
                    },
                    {
                        id: 'tom', needs: 'share', 
                        startEmoji: 'ü§§', endEmoji: 'üòã', 
                        bubbleStart: 'Tengo hambre...', bubbleEnd: '¬°Qu√© rico!', 
                        decor: 'üçé', msgCorrect: '¬°Compartir es cuidar!', msgError: 'Tom necesita compartir.'
                    }
                ],
                seeds: [
                    { type: 'care', label: 'Cuidar', icon: 'üíä', color: 'pink' },
                    { type: 'protect', label: 'Proteger', icon: 'üî¶', color: 'blue' },
                    { type: 'share', label: 'Compartir', icon: 'üç™', color: 'orange' }
                ]
            }
        ];

        const DISTRACTORS_POOL = [
            { type: 'joke', label: 'Broma', icon: 'ü§°', color: 'red' },
            { type: 'ignore', label: 'Ignorar', icon: '‚úã', color: 'blue' },
            { type: 'rush', label: 'Prisa', icon: 'üèÉ', color: 'green' }
        ];

        /* --- ESTADO GLOBAL --- */
        let currentLevelIndex = 0;
        let completedChars = 0;
        let isLevelCompleted = false;

        // Audio Context
        const AudioContext = window.AudioContext || window.webkitAudioContext;
        let audioCtx;

        /* --- INICIALIZACI√ìN --- */
        window.onload = () => {
            loadLevel(0);
        };

        /* --- FUNCIONES DE L√ìGICA DEL JUEGO --- */

        function loadLevel(index) {
            currentLevelIndex = index;
            const levelData = LEVELS_DATA[index];
            
            // 1. Resetear Estado
            completedChars = 0;
            isLevelCompleted = false;
            document.getElementById('level-indicator').innerText = `Nivel ${index + 1}: ${levelData.name}`;
            
            // 2. Configurar Fondo (Clases CSS)
            const world = document.getElementById('game-world');
            world.className = ''; // Limpiar clases anteriores
            world.classList.add(levelData.cssClass);
            
            // Restaurar filtros grises
            document.getElementById('bg-sky').classList.add('gray-filter');
            document.getElementById('bg-ground').classList.add('gray-filter');

            // 3. Renderizar Personajes
            const charsContainer = document.getElementById('chars-wrapper');
            charsContainer.innerHTML = ''; // Limpiar anterior

            levelData.characters.forEach((char, i) => {
                const charHtml = `
                    <div class="char-zone gray-filter" id="zone-${i}" data-index="${i}" data-needs="${char.needs}">
                        <div class="bubble" id="bubble-${i}">${char.bubbleStart}</div>
                        <!-- Decoraciones posicionadas relativamente aleatorias para variar -->
                        <div class="decor" style="bottom: 10px; left: 10px;">${char.decor}</div>
                        <div class="decor" style="bottom: 50px; right: 10px;">${char.decor}</div>
                        <div class="decor" style="top: 100px; left: 20px;">${char.decor}</div>
                        <div class="avatar" id="avatar-${i}">${char.startEmoji}</div>
                    </div>
                `;
                charsContainer.insertAdjacentHTML('beforeend', charHtml);
            });

            // 4. Preparar y Mezclar Semillas
            const seedsContainer = document.getElementById('seed-bar-wrapper');
            seedsContainer.innerHTML = '';
            
            // Copiar las semillas correctas
            let levelSeeds = [...levelData.seeds];
            
            // A√±adir 1 distractor aleatorio
            const randomDistractor = DISTRACTORS_POOL[Math.floor(Math.random() * DISTRACTORS_POOL.length)];
            levelSeeds.push(randomDistractor);

            // MEZCLAR (Fisher-Yates Shuffle) para que las posiciones sean aleatorias
            for (let i = levelSeeds.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [levelSeeds[i], levelSeeds[j]] = [levelSeeds[j], levelSeeds[i]];
            }

            // Renderizar Semillas
            levelSeeds.forEach(seed => {
                const seedEl = document.createElement('div');
                seedEl.className = 'seed-container';
                seedEl.innerHTML = `
                    <div class="seed" data-type="${seed.type}" data-color="${seed.color}">
                        ${seed.icon}
                    </div>
                    <div class="seed-label">${seed.label}</div>
                `;
                seedsContainer.appendChild(seedEl);
                
                // A√±adir listeners al elemento .seed reci√©n creado
                const draggable = seedEl.querySelector('.seed');
                addDragListeners(draggable);
            });
        }

        /* --- DRAG & DROP SYSTEM --- */
        let draggedItem = null;
        let clone = null;

        function addDragListeners(el) {
            el.addEventListener('mousedown', startDrag);
            el.addEventListener('touchstart', startDrag, {passive: false});
        }

        function startDrag(e) {
            e.preventDefault(); 
            initAudio();

            let clientX, clientY;
            if (e.type === 'touchstart') {
                clientX = e.touches[0].clientX;
                clientY = e.touches[0].clientY;
            } else {
                clientX = e.clientX;
                clientY = e.clientY;
            }

            draggedItem = e.target.closest('.seed'); // Asegurar seleccionar el div .seed
            if(!draggedItem) return;

            // Crear Clon Visual
            clone = draggedItem.cloneNode(true);
            clone.classList.add('dragging-clone');
            // Copiar estilos computados clave si es necesario, o confiar en CSS
            clone.style.background = getComputedStyle(draggedItem).background;
            clone.style.borderColor = getComputedStyle(draggedItem).borderColor;
            
            document.body.appendChild(clone);
            moveClone(clientX, clientY);

            document.addEventListener('mousemove', onMove);
            document.addEventListener('mouseup', onEnd);
            document.addEventListener('touchmove', onMove, {passive: false});
            document.addEventListener('touchend', onEnd);
        }

        function onMove(e) {
            e.preventDefault();
            let x, y;
            if (e.type === 'touchmove') {
                x = e.touches[0].clientX;
                y = e.touches[0].clientY;
            } else {
                x = e.clientX;
                y = e.clientY;
            }
            moveClone(x, y);
        }

        function moveClone(x, y) {
            if (clone) {
                clone.style.left = (x - 35) + 'px';
                clone.style.top = (y - 35) + 'px';
            }
        }

        function onEnd(e) {
            let x, y;
            if (e.type === 'touchend') {
                x = e.changedTouches[0].clientX;
                y = e.changedTouches[0].clientY;
            } else {
                x = e.clientX;
                y = e.clientY;
            }

            clone.style.display = 'none';
            let elemBelow = document.elementFromPoint(x, y);
            clone.remove();
            clone = null;

            let dropZone = elemBelow ? elemBelow.closest('.char-zone') : null;

            if (dropZone && draggedItem) {
                const seedType = draggedItem.dataset.type;
                const charIndex = parseInt(dropZone.dataset.index);
                checkInteraction(seedType, charIndex);
            }

            draggedItem = null;
            document.removeEventListener('mousemove', onMove);
            document.removeEventListener('mouseup', onEnd);
            document.removeEventListener('touchmove', onMove);
            document.removeEventListener('touchend', onEnd);
        }

        /* --- VERIFICACI√ìN Y L√ìGICA DE JUEGO --- */
        function checkInteraction(seedType, charIndex) {
            const currentLevel = LEVELS_DATA[currentLevelIndex];
            const charData = currentLevel.characters[charIndex];
            const zone = document.getElementById(`zone-${charIndex}`);

            // Si ya est√° resuelto, ignorar
            if (!zone.classList.contains('gray-filter')) return;

            if (seedType === charData.needs) {
                // CORRECTO
                handleSuccess(charIndex, charData);
            } else {
                // INCORRECTO
                playErrorSound();
                showMessage(charData.msgError, false);
            }
        }

        function handleSuccess(index, data) {
            playMagicSound();
            
            // Actualizar Visuales
            const zone = document.getElementById(`zone-${index}`);
            zone.classList.remove('gray-filter');
            
            const avatar = document.getElementById(`avatar-${index}`);
            avatar.innerText = data.endEmoji;
            avatar.classList.add('happy-anim');
            
            document.getElementById(`bubble-${index}`).innerText = data.bubbleEnd;
            
            // Mostrar decoraciones
            const decors = zone.querySelectorAll('.decor');
            decors.forEach(d => d.classList.add('bloomed'));

            showMessage(data.msgCorrect, true);

            completedChars++;
            
            // Verificar fin de nivel
            if (completedChars === 3) {
                handleLevelComplete();
            }
        }

        function handleLevelComplete() {
            isLevelCompleted = true;
            
            // Efecto global
            document.getElementById('bg-sky').classList.remove('gray-filter');
            document.getElementById('bg-ground').classList.remove('gray-filter');
            
            // Sonido victoria
            setTimeout(() => {
                playMagicSound();
                setTimeout(playMagicSound, 200);
            }, 500);

            // Mostrar Modal
            setTimeout(() => {
                const modal = document.getElementById('modal-overlay');
                const title = document.getElementById('modal-title');
                const msg = document.getElementById('modal-msg');
                const btn = document.getElementById('modal-btn');

                modal.style.display = 'flex';
                
                if (currentLevelIndex < LEVELS_DATA.length - 1) {
                    title.innerText = "¬°Nivel Completado!";
                    msg.innerText = "El jard√≠n est√° feliz. ¬øVamos al siguiente reto?";
                    btn.innerText = "Siguiente Nivel ‚û°Ô∏è";
                    btn.onclick = nextLevel;
                } else {
                    title.innerText = "¬°Maestro de la Empat√≠a!";
                    msg.innerText = "Has completado todos los mundos. ¬°Felicidades!";
                    btn.innerText = "Reiniciar Juego üîÑ";
                    btn.onclick = () => location.reload();
                }
            }, 1500);
        }

        function nextLevel() {
            document.getElementById('modal-overlay').style.display = 'none';
            if (currentLevelIndex < LEVELS_DATA.length - 1) {
                loadLevel(currentLevelIndex + 1);
            }
        }

        function showMessage(text, success) {
            const toast = document.getElementById('message-toast');
            toast.innerText = text;
            toast.style.background = success ? 'rgba(39, 174, 96, 0.9)' : 'rgba(192, 57, 43, 0.9)';
            toast.style.opacity = '1';
            setTimeout(() => toast.style.opacity = '0', 2500);
        }

        /* --- AUDIO --- */
        function initAudio() {
            if (!audioCtx) audioCtx = new AudioContext();
            if (audioCtx.state === 'suspended') audioCtx.resume();
        }

        function playMagicSound() {
            if(!audioCtx) return;
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.connect(gain);
            gain.connect(audioCtx.destination);
            
            osc.type = 'sine';
            osc.frequency.setValueAtTime(440, audioCtx.currentTime);
            osc.frequency.exponentialRampToValueAtTime(880, audioCtx.currentTime + 0.5);
            
            gain.gain.setValueAtTime(0.3, audioCtx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.5);
            
            osc.start();
            osc.stop(audioCtx.currentTime + 0.5);
        }

        function playErrorSound() {
            if(!audioCtx) return;
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.connect(gain);
            gain.connect(audioCtx.destination);
            
            osc.type = 'sawtooth';
            osc.frequency.setValueAtTime(150, audioCtx.currentTime);
            osc.frequency.linearRampToValueAtTime(50, audioCtx.currentTime + 0.3);
            
            gain.gain.setValueAtTime(0.2, audioCtx.currentTime);
            gain.gain.linearRampToValueAtTime(0.01, audioCtx.currentTime + 0.3);
            
            osc.start();
            osc.stop(audioCtx.currentTime + 0.3);
        }

    </script>
</body>
</html>
